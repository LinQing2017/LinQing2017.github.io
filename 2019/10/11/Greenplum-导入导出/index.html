<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>数据库调研笔记 -- GreenPlum | LQing的博客 | “做程序员太辛苦了, 我想换行，我该怎么办?” “敲一下回车。”</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="数据库,GreenPlum">
    <meta name="description" content="GreenPlum 调研笔记">
<meta name="keywords" content="数据库,GreenPlum">
<meta property="og:type" content="article">
<meta property="og:title" content="数据库调研笔记 -- GreenPlum">
<meta property="og:url" content="https:&#x2F;&#x2F;linqing2017.github.io&#x2F;2019&#x2F;10&#x2F;11&#x2F;Greenplum-%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA&#x2F;index.html">
<meta property="og:site_name" content="LQing的博客">
<meta property="og:description" content="GreenPlum 调研笔记">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-06-06T11:03:00.243Z">
<meta name="twitter:card" content="summary">
    
        <link rel="alternate" type="application/atom+xml" title="LQing的博客" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">LQing</h5>
          <a href="mailto:m15651620957@163.com" target="_blank" rel="noopener" title="m15651620957@163.com" class="mail">m15651620957@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/LinQing2017" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">数据库调研笔记 -- GreenPlum</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">数据库调研笔记 -- GreenPlum</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-10-10T16:00:00.000Z" itemprop="datePublished" class="page-time">
  2019-10-11
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#数据装载"><span class="post-toc-number">1.</span> <span class="post-toc-text">数据装载</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-INSERT语句"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">1. INSERT语句</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#性能测试"><span class="post-toc-number">1.1.1.</span> <span class="post-toc-text">性能测试</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-COPY语句"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">2. COPY语句</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#性能测试-1"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">性能测试</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#3-外部表并行读写"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">3. 外部表并行读写</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#外部表"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">外部表</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#gpfdist"><span class="post-toc-number">1.3.2.</span> <span class="post-toc-text">gpfdist</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#gpload"><span class="post-toc-number">1.3.3.</span> <span class="post-toc-text">gpload</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#性能测试-2"><span class="post-toc-number">1.3.4.</span> <span class="post-toc-text">性能测试</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#使用gpfdist和gpload转换外部数据"><span class="post-toc-number">2.</span> <span class="post-toc-text">使用gpfdist和gpload转换外部数据</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#数据导出"><span class="post-toc-number">3.</span> <span class="post-toc-text">数据导出</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#PGBench测试工具"><span class="post-toc-number">4.</span> <span class="post-toc-text">PGBench测试工具</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#null"><span class="post-toc-number">5.</span> <span class="post-toc-text"></span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#附：测试环境"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">附：测试环境</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#附：创建外部表"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">附：创建外部表</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#参考"><span class="post-toc-number">6.</span> <span class="post-toc-text">参考</span></a></li></ol>
        </nav>
    </aside>


<article id="post-Greenplum-导入导出"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">数据库调研笔记 -- GreenPlum</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-10-11 00:00:00" datetime="2019-10-10T16:00:00.000Z"  itemprop="datePublished">2019-10-11</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>GreenPlum 调研笔记</p>
<a id="more"></a>

<h1 id="数据装载"><a href="#数据装载" class="headerlink" title="数据装载"></a>数据装载</h1><h2 id="1-INSERT语句"><a href="#1-INSERT语句" class="headerlink" title="1. INSERT语句"></a>1. INSERT语句</h2><p>INSERT语句只适合在小规模的堆表场景中使用，并且有以下特点：</p>
<ul>
<li>单个INSERT命令中插入多行，如：  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> products (product_no, <span class="keyword">name</span>, price) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">'Cheese'</span>, <span class="number">9.99</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">'Bread'</span>, <span class="number">1.99</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">'Milk'</span>, <span class="number">2.99</span>);</span><br></pre></td></tr></table></figure></li>
<li>对于追加优化表， Greenplum数据库支持最多127个并发INSERT 事务插入到一个追加优化表。</li>
</ul>
<h3 id="性能测试"><a href="#性能测试" class="headerlink" title="性能测试"></a>性能测试</h3><p>通过pgbench和sysbench进行基于INSERT、UPDATE等简单SQL的性能测试，有以下发现：</p>
<ul>
<li>测试环境（32核CPU）中插入性能的瓶颈是CPU，50个线程时，单表TPS为15000~16000，单表单线程TPS为500。PS：单块SSD似乎最先到达瓶颈，但是对Greenplum进行扩容性能没有明显提升。</li>
<li><strong>关闭optimizer配置能够极大提升简单SQL的性能，测试中optimizer配置开启时性能只有原来20%，并且巨量消耗Master的CPU资源。PS：这个配置默认开启！</strong></li>
<li>Master节点上每个Client连接会产生多个Postgres进程（似乎和Segment数量有关）</li>
<li>测试中一条INSERT插入多行数据对TPS影响不大</li>
<li>gp_enable_global_deadlock_detector = on 时可以极大的提升UPDATE操作的性能（10倍以上）</li>
</ul>
<p>关于OLTP的性能测试，Greenplum官方给出了基于Greenplum 6的测试教程，测试在48核的 Master上得到了单表18000 TPS以上的性能。测试结果和实际基本符合。</p>
<p>参考：<a href="https://greenplum.org/oltp-workload-performance-improvement-in-greenplum-6/" target="_blank" rel="noopener">官方文档</a>、<a href="https://greenplum.cn/2019/05/14/greenplum-6-oltp-60x/" target="_blank" rel="noopener">中文社区翻译</a></p>
<h2 id="2-COPY语句"><a href="#2-COPY语句" class="headerlink" title="2. COPY语句"></a>2. COPY语句</h2><p> COPY命令是非并行操作，数据流需要通过Master实例。</p>
<ul>
<li>COPY只能用于表，不能用于视图。</li>
<li>，支持常用的文件格式，如：txt、sql、csv、压缩文件、二进制格式等</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- COPY 语句只能在master节点上运行</span></span><br><span class="line">COPY table_name FROM '/path/to/filename' <span class="keyword">WITH</span> (<span class="keyword">FORMAT</span> csv);</span><br><span class="line"><span class="comment">-- \copy 语句可以在client节点上运行，其基于COPY FROM STDIN语句从STDIN读取输入并发送给Master</span></span><br><span class="line">\copy table_name FROM '/path/to/filename';</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用COPY命令导出数据</span></span><br><span class="line">COPY (<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> pgbench_accounts <span class="keyword">limit</span> <span class="number">10</span>) <span class="keyword">TO</span> <span class="string">'/home/gpadmin/pgbench_accounts.csv'</span> <span class="keyword">WITH</span> csv;</span><br></pre></td></tr></table></figure>
<p>默认情况下，COPY会在第一个错误处停止操作：如果数据包含一个错误，该操作失败并且没有数据被装载(即没有一条数据被导入)。</p>
<p>用户可以使用单行错误隔离模式，Greenplum会跳过包含格式错误的行并且装载正确格式化的行。需要注意的是：这里的错误指数据格式的错误，不包含约束错误。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用单行错误隔离模式，每个segment容许10行错误</span></span><br><span class="line">COPY country FROM '/data/gpdb/country_data' </span><br><span class="line">   <span class="keyword">WITH</span> DELIMITER <span class="string">'|'</span> <span class="keyword">LOG</span> <span class="keyword">ERRORS</span></span><br><span class="line">   <span class="keyword">SEGMENT</span> <span class="keyword">REJECT</span> <span class="keyword">LIMIT</span> <span class="number">10</span> <span class="keyword">ROWS</span>;</span><br></pre></td></tr></table></figure>

<h3 id="性能测试-1"><a href="#性能测试-1" class="headerlink" title="性能测试"></a>性能测试</h3><p>使用COPY命令<strong>单线程</strong>，导入<strong>1亿</strong>条数据，数据原始大小9.7GB，用时136692.713 ms，平均<strong>731567条/s</strong>。</p>
<p>测试过程中，磁盘性能优先达到瓶颈。</p>
<p>调优建议：</p>
<ul>
<li>在装载数据到新表中时，最后创建索引。</li>
<li>装载完成后执行VACUUM ANALYZE来为查询优化器更新表统计信息</li>
<li>在装载错误后运行VACUUM，清理缓存表。<h2 id="3-外部表并行读写"><a href="#3-外部表并行读写" class="headerlink" title="3. 外部表并行读写"></a>3. 外部表并行读写</h2></li>
</ul>
<p>通过外部表，可以使向Greenplum导入导出数据并行化，使Greenplum真正具备并行读写的能力。</p>
<p>导入数据：</p>
<pre><code>- 准备数据文件
- 创建外部表（初次导入时还要创建数据表）
- INSERT INTO tablename  SELECT * from tablename_ext_temp;
- 删除外部表、外部数据文件</code></pre><h3 id="外部表"><a href="#外部表" class="headerlink" title="外部表"></a>外部表</h3><p>根据外部表允许的操作，包括：</p>
<ul>
<li>可读外部表：仅允许SELECT操作。</li>
<li>可写外部表：仅允许INSERT操作</li>
</ul>
<p>根据外部表数据源的状态，包括：</p>
<ul>
<li><p>普通（基于文件的）：访问静态平面文件</p>
</li>
<li><p>Web（基于Web的）：访问动态数据源</p>
<ul>
<li><p>基于命令的web表：建表时将table关联到可执行脚本，每次查询时基于脚本的返回结果，因此该表对应的返回值是动态的，用户可以指定master或者特定segments运行这个脚本。</p>
</li>
<li><p>基于URL的web表：定义表时LOCATION里定义基于http://协议的web服务文件路径，指定的http地址数目取决于GP集群中的Segment数目。</p>
</li>
</ul>
</li>
</ul>
<p>当前支持的外部表协议：</p>
<table>
<thead>
<tr>
<th>协议类型</th>
<th>表类型</th>
<th>数据存放位置</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>file</td>
<td>只能是可读表</td>
<td>Segment主机</td>
<td>每个Segment只能处理一个外部文件，所以单个Seg-Host上的文件数目，取决于运行Segment实例数目</td>
</tr>
<tr>
<td>gpfdist/gpfdists</td>
<td>可读/写表</td>
<td>gpfdist服务器（一个或者多个）</td>
<td>跨主机协议、支持数据压缩和数据转换</td>
</tr>
<tr>
<td>pxf、S3</td>
<td>自定义接口</td>
<td>Hadoop系统、对象存储等</td>
<td></td>
</tr>
</tbody></table>
<p>定义外部表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- file 外部表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> ext_expenses (</span><br><span class="line">   <span class="keyword">name</span> <span class="built_in">text</span>, <span class="built_in">date</span> <span class="built_in">date</span>, amount float4, <span class="keyword">category</span> <span class="built_in">text</span>, desc1 <span class="built_in">text</span> ) </span><br><span class="line">LOCATION (<span class="string">'file://host1:5432/data/expense/*.csv'</span>, </span><br><span class="line">          <span class="string">'file://host2:5432/data/expense/*.csv'</span>, </span><br><span class="line">          <span class="string">'file://host3:5432/data/expense/*.csv'</span>) </span><br><span class="line"><span class="keyword">FORMAT</span> <span class="string">'CSV'</span> (HEADER); </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 基于命令的web外部表</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> WEB <span class="keyword">TABLE</span> log_output </span><br><span class="line">    (linenum <span class="built_in">int</span>, message <span class="built_in">text</span>) </span><br><span class="line">    <span class="keyword">EXECUTE</span> <span class="string">'/var/load_scripts/get_log_data.sh'</span> <span class="keyword">ON</span> HOST</span><br><span class="line">    <span class="keyword">FORMAT</span> <span class="string">'TEXT'</span> (DELIMITER <span class="string">'|'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="gpfdist"><a href="#gpfdist" class="headerlink" title="gpfdist"></a>gpfdist</h3><p>通常情况下，gpfdist作为一个第三方服务运行在Greenplum集群之外的服务器上（一般是ETL服务器）。Greenplum和gpfdist服务之间通过HTTP/HTTPS协议通信。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动gpfdist服务，配置数据目录和日志目（建议先安装Greenplum，否则启动可能缺依赖）</span></span><br><span class="line">gpfdist -d /data/data_ssd/gpfdist_files -p 18081 -l /var/log/gpfdist/gpfdist.log &amp;</span><br></pre></td></tr></table></figure>

<p>gpfdist的优势：</p>
<ul>
<li>外部文件支持压缩、CSV等格式</li>
<li>支持将外部XML（json）文件读入Greenplum数据库（通过配置YAML格式的文件）</li>
<li>外部表可以连接一个或多个gpfdist实例（无论一个还是多个，Segment连接外部表时均是并行的）</li>
<li>一台ETL服务器上可以运行多个gpfdist实例（不同的数据目录，以及端口）</li>
</ul>
<p>性能控制：</p>
<ul>
<li>gp_external_max_segs：数控制能同时访问单一gpfdist实例的Segment实例数量，默认64个；</li>
</ul>
<h3 id="gpload"><a href="#gpload" class="headerlink" title="gpload"></a>gpload</h3><p>gpload是Greenplum提供的并行导入工具，工作原理基于gpfdist，用户通过定义YAML文件来控制gpload导入的表结构。</p>
<ul>
<li>支持多种表导入模式<ul>
<li>INSERT</li>
<li>UPDATE</li>
<li>MERGE</li>
</ul>
</li>
<li>gpload会在外部文件上重新拉起gpfdist进程，知道导入完成</li>
<li>gpload会创建一张临时外部表，因此执行用户要有建外部表权限，以及写入数据权限</li>
</ul>
<p>gpload的导入命令为:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpload -f insert.yaml -l gpload.log</span><br></pre></td></tr></table></figure>
<p>gpload使用的控制文件如下:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">VERSION:</span> <span class="number">1.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"><span class="attr">DATABASE:</span> <span class="string">pgbench</span></span><br><span class="line"><span class="attr">USER:</span> <span class="string">benchtest</span></span><br><span class="line"><span class="attr">HOST:</span> <span class="number">172.24</span><span class="number">.9</span><span class="number">.12</span></span><br><span class="line"><span class="attr">PORT:</span> <span class="number">5432</span></span><br><span class="line"><span class="attr">GPLOAD:</span></span><br><span class="line"><span class="attr">   INPUT:</span></span><br><span class="line"><span class="attr">    - SOURCE:</span></span><br><span class="line"><span class="attr">         LOCAL_HOSTNAME:</span></span><br><span class="line"><span class="bullet">           -</span> <span class="number">172.24</span><span class="number">.33</span><span class="number">.35</span></span><br><span class="line"><span class="attr">         PORT:</span> <span class="number">19090</span></span><br><span class="line"><span class="attr">         FILE:</span></span><br><span class="line"><span class="bullet">           -</span> <span class="string">/data/data_ssd/gpfdist_files/pgbench/pgbench_accounts/*</span></span><br><span class="line"><span class="attr">    - COLUMNS:</span></span><br><span class="line"><span class="attr">               - aid:</span> <span class="string">integer</span></span><br><span class="line"><span class="attr">               - bid:</span> <span class="string">integer</span></span><br><span class="line"><span class="attr">               - abalance:</span> <span class="string">integer</span></span><br><span class="line"><span class="attr">               - filler:</span> <span class="string">character(84)</span></span><br><span class="line"><span class="attr">    - FORMAT:</span> <span class="string">csv</span></span><br><span class="line"><span class="attr">    - DELIMITER:</span> <span class="string">','</span></span><br><span class="line"><span class="attr">    - QUOTE:</span> <span class="string">'"'</span></span><br><span class="line"><span class="attr">    - HEADER:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">   OUTPUT:</span></span><br><span class="line"><span class="attr">    - TABLE:</span> <span class="string">public.pgbench_accounts_gpload_ins</span></span><br><span class="line"><span class="attr">    - MODE:</span> <span class="string">INSERT</span></span><br></pre></td></tr></table></figure>

<p>详细参数说明参考<a href="https://gp-docs-cn.github.io/docs/utility_guide/admin_utilities/gpload.html" target="_blank" rel="noopener">官方文档</a></p>
<h3 id="性能测试-2"><a href="#性能测试-2" class="headerlink" title="性能测试"></a>性能测试</h3><p>使用<strong>单点gpfdist服务</strong>将外部表导入为GP的系统，导入<strong>1亿</strong>条数据，数据原始大小9.7GB，用时35962.171 ms，平均<strong>2780699条/s</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建内部堆表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> pgbench_accounts (</span><br><span class="line">    aid <span class="built_in">integer</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    bid <span class="built_in">integer</span>,</span><br><span class="line">    abalance <span class="built_in">integer</span>,</span><br><span class="line">    filler <span class="built_in">character</span>(<span class="number">84</span>)</span><br><span class="line">) <span class="keyword">WITH</span> (fillfactor=<span class="string">'100'</span>) <span class="keyword">DISTRIBUTED</span> <span class="keyword">BY</span> (aid);</span><br><span class="line"></span><br><span class="line"><span class="comment">--  创建外部表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> pgbench_accounts_ext_tmp ( </span><br><span class="line">    aid <span class="built_in">integer</span>, </span><br><span class="line">    bid <span class="built_in">integer</span>, </span><br><span class="line">    abalance <span class="built_in">integer</span>, </span><br><span class="line">    filler <span class="built_in">character</span>(<span class="number">84</span>) </span><br><span class="line">) LOCATION (<span class="string">'gpfdist://172.24.33.35:18081/pgbench/pgbench_accounts/*'</span>) <span class="keyword">FORMAT</span> <span class="string">'csv'</span>;</span><br><span class="line"><span class="comment">-- 导入堆表</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> pgbench_accounts  <span class="keyword">SELECT</span> * <span class="keyword">from</span> pgbench_accounts_ext_tmp;</span><br></pre></td></tr></table></figure>


<h1 id="使用gpfdist和gpload转换外部数据"><a href="#使用gpfdist和gpload转换外部数据" class="headerlink" title="使用gpfdist和gpload转换外部数据"></a>使用gpfdist和gpload转换外部数据</h1><p>Greenplum支持将任意格式的数据导入到数据中，或者将数据库中表以任意格式导出，以下说明导入XML到Greenplum的表中。</p>
<p>XML文件内容（文件名为pricerecord.xml）如下，包含：itemnumber和price两个字段。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="ISO-8859-1" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">prices</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pricerecord</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">itemnumber</span>&gt;</span>708421<span class="tag">&lt;/<span class="name">itemnumber</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>19.99<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">pricerecord</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pricerecord</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">itemnumber</span>&gt;</span>708466<span class="tag">&lt;/<span class="name">itemnumber</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>59.25<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">pricerecord</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pricerecord</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">itemnumber</span>&gt;</span>711121<span class="tag">&lt;/<span class="name">itemnumber</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">price</span>&gt;</span>24.99<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">pricerecord</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">prices</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>对应的表结构为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> prices (</span><br><span class="line">	itemnumber <span class="built_in">integer</span>,       </span><br><span class="line">	price      <span class="built_in">decimal</span>        </span><br><span class="line">) <span class="keyword">DISTRIBUTED</span> <span class="keyword">BY</span> (itemnumber);</span><br></pre></td></tr></table></figure>

<p>进行导入前，用户需要准备一个脚本工具解析XML文档，该工具不限格式，应当有如下输出：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 需要注意的是：工具输出中不能带空行</span></span><br><span class="line">708421|19.99</span><br><span class="line">708466|59.25</span><br><span class="line">711121|24.99</span><br></pre></td></tr></table></figure>

<p>用户可以定义config.xml文件，将声明脚本解析工具，该文件中的参数<a href="https://greenplum.cn/gp6/load/topics/transforming-xml-data.html" target="_blank" rel="noopener">配置文件格式</a>：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">VERSION:</span> <span class="number">1.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"><span class="attr">TRANSFORMATIONS:</span></span><br><span class="line"><span class="attr">    transformation_name1:</span>              <span class="comment"># 转换名称</span></span><br><span class="line"><span class="attr">        TYPE:</span>     <span class="string">input</span>               <span class="comment"># 转换类型，input或者output</span></span><br><span class="line"><span class="attr">        COMMAND:</span>  <span class="string">/bin/sh</span> <span class="string">trans_script.sh</span> <span class="string">%filename%</span>     <span class="comment"># 转换命令</span></span><br><span class="line"></span><br><span class="line"><span class="attr">    transformation_name2:</span>         </span><br><span class="line"><span class="attr">        TYPE:</span>     <span class="string">output</span>              </span><br><span class="line"><span class="attr">        COMMAND:</span>  <span class="string">/bin/sh</span> <span class="string">trans_script.sh</span> <span class="string">%filename%</span> </span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span><span class="bullet">-</span> <span class="string">COMMAND中的</span> <span class="string">%filename%</span> <span class="string">在执行是被gpload配置文件中的定义替换</span></span><br></pre></td></tr></table></figure>

<p>创建gpload配置文件如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">VERSION:</span> <span class="number">1.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"><span class="attr">DATABASE:</span> <span class="string">pgbench</span></span><br><span class="line"><span class="attr">USER:</span> <span class="string">benchtest</span></span><br><span class="line"><span class="attr">HOST:</span> <span class="number">172.24</span><span class="number">.9</span><span class="number">.12</span></span><br><span class="line"><span class="attr">PORT:</span> <span class="number">5432</span></span><br><span class="line"><span class="attr">GPLOAD:</span></span><br><span class="line"><span class="attr">   INPUT:</span></span><br><span class="line"><span class="attr">     - TRANSFORM_CONFIG:</span> <span class="string">config.yaml</span>   <span class="comment"># 定义转换配置</span></span><br><span class="line"><span class="attr">     - TRANSFORM:</span> <span class="string">prices_input</span>         <span class="comment"># 定义要使用的转换</span></span><br><span class="line"><span class="attr">     - SOURCE:</span></span><br><span class="line"><span class="attr">         LOCAL_HOSTNAME:</span></span><br><span class="line"><span class="bullet">           -</span> <span class="number">172.24</span><span class="number">.9</span><span class="number">.12</span></span><br><span class="line"><span class="attr">         PORT:</span> <span class="number">19090</span></span><br><span class="line"><span class="attr">         FILE:</span> </span><br><span class="line"><span class="bullet">           -</span> <span class="string">pricerecord.xml</span>           <span class="comment"># 待导入的xml文件（替换%filename% ）</span></span><br><span class="line"><span class="attr">     - COLUMNS:</span></span><br><span class="line"><span class="attr">         - itemnumber:</span> <span class="string">integer</span></span><br><span class="line"><span class="attr">         - price:</span> <span class="string">decimal</span></span><br><span class="line"><span class="attr">     - FORMAT:</span> <span class="string">TEXT</span></span><br><span class="line"><span class="attr">     - DELIMITER:</span> <span class="string">'|'</span></span><br><span class="line"><span class="attr">     - QUOTE:</span> <span class="string">'"'</span></span><br><span class="line"><span class="attr">     - HEADER:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">   OUTPUT:</span></span><br><span class="line"><span class="attr">     - TABLE:</span> <span class="string">public.prices</span></span><br><span class="line"><span class="attr">     - MODE:</span> <span class="string">INSERT</span></span><br></pre></td></tr></table></figure>

<p><strong>PS：用户也可以执行 gpfdist -c config.yaml 将装换加载到gpfdist中，创建外表直接读取xml文档</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> READABLE <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> prices_readable (<span class="keyword">LIKE</span> prices)</span><br><span class="line">   LOCATION (<span class="string">'gpfdist://hostname:8080/prices.xml#transform=prices_input'</span>)</span><br><span class="line">   <span class="keyword">FORMAT</span> <span class="string">'TEXT'</span> (DELIMITER <span class="string">'|'</span>)</span><br><span class="line">   <span class="keyword">LOG</span> <span class="keyword">ERRORS</span> <span class="keyword">SEGMENT</span> <span class="keyword">REJECT</span> <span class="keyword">LIMIT</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<h1 id="数据导出"><a href="#数据导出" class="headerlink" title="数据导出"></a>数据导出</h1><p>使用<strong>CREATE WRITABLE EXTERNAL TABLE</strong>命令定义外部表时，可以将数据导出到本地。</p>
<ul>
<li>Segment把数据发送到gpfdist，后者会把数据写到指定的文件中；</li>
<li>外部表定义中定义多个gpfdist URI时，输出数据划分到多个文件之间；</li>
<li>可写的外部Web表把输出行发送到一个脚本（或者应用）作为输入。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 写入到gpfdist的外部表</span></span><br><span class="line"><span class="keyword">CREATE</span> WRITABLE <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> unload_expenses  ( <span class="keyword">LIKE</span> expenses ) </span><br><span class="line">   LOCATION (<span class="string">'gpfdist://etlhost-1:8081/expenses1.out'</span>, </span><br><span class="line">             <span class="string">'gpfdist://etlhost-2:8081/expenses2.out'</span>)</span><br><span class="line"><span class="keyword">FORMAT</span> <span class="string">'TEXT'</span> (DELIMITER <span class="string">','</span>) <span class="keyword">DISTRIBUTED</span> <span class="keyword">BY</span> (exp_id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 写入到HDFS的外部表</span></span><br><span class="line"><span class="keyword">CREATE</span> WRITABLE <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> unload_expenses  ( <span class="keyword">LIKE</span> expenses ) </span><br><span class="line">   LOCATION (<span class="string">'pxf://dir/path?PROFILE=hdfs:text'</span>) </span><br><span class="line"><span class="keyword">FORMAT</span> <span class="string">'TEXT'</span> (DELIMITER <span class="string">','</span>) <span class="keyword">DISTRIBUTED</span> <span class="keyword">BY</span> (exp_id);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 可写外部web表，EXECUTE程序处理insert到这个表的每一行</span></span><br><span class="line"><span class="comment">-- 参考https://greenplum.cn/gp6/load/topics/g-defining-a-command-based-writable-external-web-table.html</span></span><br><span class="line"><span class="keyword">CREATE</span> WRITABLE <span class="keyword">EXTERNAL</span> WEB <span class="keyword">TABLE</span> <span class="keyword">output</span> (<span class="keyword">output</span> <span class="built_in">text</span>) </span><br><span class="line">    <span class="keyword">EXECUTE</span> <span class="string">'export PATH=$PATH:/home/gpadmin/programs; myprogram.sh'</span> </span><br><span class="line"><span class="keyword">FORMAT</span> <span class="string">'TEXT'</span> <span class="keyword">DISTRIBUTED</span> RANDOMLY</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 向外部表写入</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">INSERT</span> <span class="keyword">ON</span> writable_ext_table <span class="keyword">TO</span> <span class="keyword">admin</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> writable_ext_table <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> regular_table;</span><br></pre></td></tr></table></figure>

<p>直接用COPY命令也可以导出，但是此时性能瓶颈受限于Master服务：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">COPY (<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> country <span class="keyword">WHERE</span> country_name <span class="keyword">LIKE</span> <span class="string">'A%'</span>) </span><br><span class="line"><span class="keyword">TO</span> <span class="string">'/home/gpadmin/a_list_countries.out'</span>;</span><br></pre></td></tr></table></figure>



<h1 id="PGBench测试工具"><a href="#PGBench测试工具" class="headerlink" title="PGBench测试工具"></a>PGBench测试工具</h1><p>pgbench是 PostgreSQL 上自带一个基准测试工具，能够让用户并发执行多次SQL语句，并且统计测试的TPS。</p>
<p>默认情况下，如果用户不提供自定义的测试SQL，那么测试时使用TPC-B方式进行OLTP测试，执行</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">-- 初始化测试数据库，比例因子-s（系数是10万），执行后pgbench中包括以下几张表：</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">--  table                   # of rows</span></span><br><span class="line"><span class="comment">--  ---------------------------------</span></span><br><span class="line"><span class="comment">--  pgbench_branches        1 * 1000</span></span><br><span class="line"><span class="comment">--  pgbench_tellers         10 * 1000</span></span><br><span class="line"><span class="comment">--  pgbench_accounts        100000 * 1000</span></span><br><span class="line"><span class="comment">--  pgbench_history         0 * 1000</span></span><br><span class="line"></span><br><span class="line">pgbench -i -s 1000 pgbench</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 重要的测试选项包括-c（客户端数量）、 -t（事务数量）、-T（时间限制）以及-f（指定一个自定义脚本文件）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- pgbench 默认有三个内建脚本，分别是：tpcb-like、simple-update、select-only</span></span><br><span class="line">pgbench -c 100 -j 100 -r -T 60 -P 1 -s 1000 -b tpcb-like pgbench</span><br><span class="line">pgbench -c 100 -j 100 -r -T 60 -P 1 -s 1000 -b simple-<span class="keyword">update</span> pgbench</span><br><span class="line">pgbench -c <span class="number">100</span> -j <span class="number">100</span> -r -T <span class="number">60</span> -P <span class="number">1</span> -s <span class="number">1000</span> -b <span class="keyword">select</span>-<span class="keyword">only</span> pgbench</span><br></pre></td></tr></table></figure>

<p>以下是自定义测试脚本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">\set scale 10000</span><br><span class="line">\set nbranches 1 * :scale</span><br><span class="line">\set ntellers 10 * :scale</span><br><span class="line">\set naccounts 100000 * :scale</span><br><span class="line">\set aid random(1,:naccounts)</span><br><span class="line">\set bid random(1,:nbranches)</span><br><span class="line">\set tid random(1,:ntellers)</span><br><span class="line">\set delta random(-5000,5000)</span><br><span class="line"></span><br><span class="line">INSERT INTO pgbench_history (tid, bid, aid, delta, mtime) VALUES (:tid, :bid, :aid, :delta, CURRENT_TIMESTAMP);</span><br></pre></td></tr></table></figure>

<h1 id=""><a href="#" class="headerlink" title=""></a></h1><h2 id="附：测试环境"><a href="#附：测试环境" class="headerlink" title="附：测试环境"></a>附：测试环境</h2><p>服务器：6 * 3 Segment（Master和Segment混合部署，并且共用一块SSD，并且配置mirror）<br>CPU：Intel(R) Xeon(R) CPU E5-2620 v4 @ 2.10GHz 32核<br>内存：  125G<br>网络：10GB光纤</p>
<h2 id="附：创建外部表"><a href="#附：创建外部表" class="headerlink" title="附：创建外部表"></a>附：创建外部表</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 普通可读外部表</span></span><br><span class="line"><span class="keyword">CREATE</span> [READABLE] <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> table_name    </span><br><span class="line">    ( column_name data_type [, ...] | <span class="keyword">LIKE</span> other_table )</span><br><span class="line">      LOCATION (<span class="string">'file://seghost[:port]/path/file'</span> [, ...])</span><br><span class="line">        | (<span class="string">'gpfdist://filehost[:port]/file_pattern[#transform]'</span></span><br><span class="line">        | (<span class="string">'gpfdists://filehost[:port]/file_pattern[#transform]'</span></span><br><span class="line">            [, ...])</span><br><span class="line">        | (<span class="string">'gphdfs://hdfs_host[:port]/path/file'</span>)</span><br><span class="line">      <span class="keyword">FORMAT</span> <span class="string">'TEXT'</span></span><br><span class="line">            [( [HEADER]</span><br><span class="line">               [DELIMITER [<span class="keyword">AS</span>] <span class="string">'delimiter'</span> | <span class="string">'OFF'</span>]</span><br><span class="line">               [<span class="literal">NULL</span> [<span class="keyword">AS</span>] <span class="string">'null string'</span>]</span><br><span class="line">               [ESCAPE [<span class="keyword">AS</span>] <span class="string">'escape'</span> | <span class="string">'OFF'</span>]</span><br><span class="line">               [<span class="keyword">NEWLINE</span> [ <span class="keyword">AS</span> ] <span class="string">'LF'</span> | <span class="string">'CR'</span> | <span class="string">'CRLF'</span>]</span><br><span class="line">               [FILL <span class="keyword">MISSING</span> <span class="keyword">FIELDS</span>] )]</span><br><span class="line">           | <span class="string">'CSV'</span></span><br><span class="line">            [( [HEADER]</span><br><span class="line">               [QUOTE [<span class="keyword">AS</span>] <span class="string">'quote'</span>]</span><br><span class="line">               [DELIMITER [<span class="keyword">AS</span>] <span class="string">'delimiter'</span>]</span><br><span class="line">               [<span class="literal">NULL</span> [<span class="keyword">AS</span>] <span class="string">'null string'</span>]</span><br><span class="line">               [<span class="keyword">FORCE</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">column</span> [, ...]]</span><br><span class="line">               [ESCAPE [<span class="keyword">AS</span>] <span class="string">'escape'</span>]</span><br><span class="line">               [<span class="keyword">NEWLINE</span> [ <span class="keyword">AS</span> ] <span class="string">'LF'</span> | <span class="string">'CR'</span> | <span class="string">'CRLF'</span>]</span><br><span class="line">               [FILL <span class="keyword">MISSING</span> <span class="keyword">FIELDS</span>] )]</span><br><span class="line">           | <span class="string">'AVRO'</span></span><br><span class="line">           | <span class="string">'PARQUET'</span></span><br><span class="line"> </span><br><span class="line">           | <span class="string">'CUSTOM'</span> (Formatter=&lt;formatter specifications&gt;)</span><br><span class="line">     [ <span class="keyword">ENCODING</span> <span class="string">'encoding'</span> ]</span><br><span class="line">     [ [<span class="keyword">LOG</span> <span class="keyword">ERRORS</span> [<span class="keyword">INTO</span> error_table]] <span class="keyword">SEGMENT</span> <span class="keyword">REJECT</span> <span class="keyword">LIMIT</span> <span class="keyword">count</span></span><br><span class="line">       [<span class="keyword">ROWS</span> | <span class="keyword">PERCENT</span>] ]</span><br><span class="line"></span><br><span class="line"><span class="comment">-- web可读外部表，每次读的数据动态变化</span></span><br><span class="line"><span class="keyword">CREATE</span> [READABLE] <span class="keyword">EXTERNAL</span> WEB <span class="keyword">TABLE</span> table_name    </span><br><span class="line">   ( column_name data_type [, ...] | <span class="keyword">LIKE</span> other_table )</span><br><span class="line">      LOCATION (<span class="string">'http://webhost[:port]/path/file'</span> [, ...])</span><br><span class="line">    | <span class="keyword">EXECUTE</span> <span class="string">'command'</span> [<span class="keyword">ON</span> <span class="keyword">ALL</span></span><br><span class="line">                          | <span class="keyword">MASTER</span></span><br><span class="line">                          | number_of_segments</span><br><span class="line">                          | HOST [<span class="string">'segment_hostname'</span>]</span><br><span class="line">                          | <span class="keyword">SEGMENT</span> segment_id ]</span><br><span class="line">      <span class="keyword">FORMAT</span> <span class="string">'TEXT'</span></span><br><span class="line">            [( [HEADER]</span><br><span class="line">               [DELIMITER [<span class="keyword">AS</span>] <span class="string">'delimiter'</span> | <span class="string">'OFF'</span>]</span><br><span class="line">               [<span class="literal">NULL</span> [<span class="keyword">AS</span>] <span class="string">'null string'</span>]</span><br><span class="line">               [ESCAPE [<span class="keyword">AS</span>] <span class="string">'escape'</span> | <span class="string">'OFF'</span>]</span><br><span class="line">               [<span class="keyword">NEWLINE</span> [ <span class="keyword">AS</span> ] <span class="string">'LF'</span> | <span class="string">'CR'</span> | <span class="string">'CRLF'</span>]</span><br><span class="line">               [FILL <span class="keyword">MISSING</span> <span class="keyword">FIELDS</span>] )]</span><br><span class="line">           | <span class="string">'CSV'</span></span><br><span class="line">            [( [HEADER]</span><br><span class="line">               [QUOTE [<span class="keyword">AS</span>] <span class="string">'quote'</span>]</span><br><span class="line">               [DELIMITER [<span class="keyword">AS</span>] <span class="string">'delimiter'</span>]</span><br><span class="line">               [<span class="literal">NULL</span> [<span class="keyword">AS</span>] <span class="string">'null string'</span>]</span><br><span class="line">               [<span class="keyword">FORCE</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">column</span> [, ...]]</span><br><span class="line">               [ESCAPE [<span class="keyword">AS</span>] <span class="string">'escape'</span>]</span><br><span class="line">               [<span class="keyword">NEWLINE</span> [ <span class="keyword">AS</span> ] <span class="string">'LF'</span> | <span class="string">'CR'</span> | <span class="string">'CRLF'</span>]</span><br><span class="line">               [FILL <span class="keyword">MISSING</span> <span class="keyword">FIELDS</span>] )]</span><br><span class="line">           | <span class="string">'CUSTOM'</span> (Formatter=&lt;formatter specifications&gt;)</span><br><span class="line">     [ <span class="keyword">ENCODING</span> <span class="string">'encoding'</span> ]</span><br><span class="line">     [ [<span class="keyword">LOG</span> <span class="keyword">ERRORS</span> [<span class="keyword">INTO</span> error_table]] <span class="keyword">SEGMENT</span> <span class="keyword">REJECT</span> <span class="keyword">LIMIT</span> <span class="keyword">count</span></span><br><span class="line">       [<span class="keyword">ROWS</span> | <span class="keyword">PERCENT</span>] ]</span><br><span class="line"> </span><br><span class="line"><span class="comment">-- 普通可写外部表</span></span><br><span class="line"><span class="keyword">CREATE</span> WRITABLE <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line">    ( column_name data_type [, ...] | <span class="keyword">LIKE</span> other_table )</span><br><span class="line">     LOCATION(<span class="string">'gpfdist://outputhost[:port]/filename[#transform]'</span></span><br><span class="line">      | (<span class="string">'gpfdists://outputhost[:port]/file_pattern[#transform]'</span></span><br><span class="line">          [, ...])</span><br><span class="line">      | (<span class="string">'gphdfs://hdfs_host[:port]/path'</span>)</span><br><span class="line">      <span class="keyword">FORMAT</span> <span class="string">'TEXT'</span></span><br><span class="line">               [( [DELIMITER [<span class="keyword">AS</span>] <span class="string">'delimiter'</span>]</span><br><span class="line">               [<span class="literal">NULL</span> [<span class="keyword">AS</span>] <span class="string">'null string'</span>]</span><br><span class="line">               [ESCAPE [<span class="keyword">AS</span>] <span class="string">'escape'</span> | <span class="string">'OFF'</span>] )]</span><br><span class="line">          | <span class="string">'CSV'</span></span><br><span class="line">               [([QUOTE [<span class="keyword">AS</span>] <span class="string">'quote'</span>]</span><br><span class="line">               [DELIMITER [<span class="keyword">AS</span>] <span class="string">'delimiter'</span>]</span><br><span class="line">               [<span class="literal">NULL</span> [<span class="keyword">AS</span>] <span class="string">'null string'</span>]</span><br><span class="line">               [<span class="keyword">FORCE</span> QUOTE <span class="keyword">column</span> [, ...]] ]</span><br><span class="line">               [ESCAPE [<span class="keyword">AS</span>] <span class="string">'escape'</span>] )]</span><br><span class="line">           | <span class="string">'AVRO'</span></span><br><span class="line">           | <span class="string">'PARQUET'</span></span><br><span class="line"> </span><br><span class="line">           | <span class="string">'CUSTOM'</span> (Formatter=&lt;formatter specifications&gt;)</span><br><span class="line">    [ <span class="keyword">ENCODING</span> <span class="string">'write_encoding'</span> ]</span><br><span class="line">    [ <span class="keyword">DISTRIBUTED</span> <span class="keyword">BY</span> (<span class="keyword">column</span>, [ ... ] ) | <span class="keyword">DISTRIBUTED</span> RANDOMLY ]</span><br><span class="line"> </span><br><span class="line"><span class="comment">-- web可写外部表</span></span><br><span class="line"><span class="keyword">CREATE</span> WRITABLE <span class="keyword">EXTERNAL</span> WEB <span class="keyword">TABLE</span> table_name</span><br><span class="line">    ( column_name data_type [, ...] | <span class="keyword">LIKE</span> other_table )</span><br><span class="line">    <span class="keyword">EXECUTE</span> <span class="string">'command'</span> [<span class="keyword">ON</span> <span class="keyword">ALL</span>]</span><br><span class="line">    <span class="keyword">FORMAT</span> <span class="string">'TEXT'</span></span><br><span class="line">               [( [DELIMITER [<span class="keyword">AS</span>] <span class="string">'delimiter'</span>]</span><br><span class="line">               [<span class="literal">NULL</span> [<span class="keyword">AS</span>] <span class="string">'null string'</span>]</span><br><span class="line">               [ESCAPE [<span class="keyword">AS</span>] <span class="string">'escape'</span> | <span class="string">'OFF'</span>] )]</span><br><span class="line">          | <span class="string">'CSV'</span></span><br><span class="line">               [([QUOTE [<span class="keyword">AS</span>] <span class="string">'quote'</span>]</span><br><span class="line">               [DELIMITER [<span class="keyword">AS</span>] <span class="string">'delimiter'</span>]</span><br><span class="line">               [<span class="literal">NULL</span> [<span class="keyword">AS</span>] <span class="string">'null string'</span>]</span><br><span class="line">               [<span class="keyword">FORCE</span> QUOTE <span class="keyword">column</span> [, ...]] ]</span><br><span class="line">               [ESCAPE [<span class="keyword">AS</span>] <span class="string">'escape'</span>] )]</span><br><span class="line">           | <span class="string">'CUSTOM'</span> (Formatter=&lt;formatter specifications&gt;)</span><br><span class="line">    [ <span class="keyword">ENCODING</span> <span class="string">'write_encoding'</span> ]</span><br><span class="line">    [ <span class="keyword">DISTRIBUTED</span> <span class="keyword">BY</span> (<span class="keyword">column</span>, [ ... ] ) | <span class="keyword">DISTRIBUTED</span> RANDOMLY ]</span><br></pre></td></tr></table></figure>

<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://cloud.tencent.com/developer/article/1447227" target="_blank" rel="noopener">GP系统配置参数</a></p>
<p><a href="https://greenplum.cn/gp6/load/topics/transforming-xml-data.html" target="_blank" rel="noopener">XML转换示例</a></p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2020-06-06T11:03:00.243Z" itemprop="dateUpdated">2020-06-06 19:03:00</time>
</span><br>


        
        原文地址 ：<a href="/2019/10/11/Greenplum-%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/" target="_blank" rel="external">https://linqing2017.github.io/2019/10/11/Greenplum-%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/</a>
        
    </div>
    
    <footer>
        <a href="https://LinQing2017.github.io">
            <img src="/img/avatar.jpg" alt="LQing">
            LQing
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GreenPlum/" rel="tag">GreenPlum</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://linqing2017.github.io/2019/10/11/Greenplum-%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/&title=《数据库调研笔记 -- GreenPlum》 — LQing的博客&pic=https://LinQing2017.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://linqing2017.github.io/2019/10/11/Greenplum-%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/&title=《数据库调研笔记 -- GreenPlum》 — LQing的博客&source=GreenPlum 调研笔记" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://linqing2017.github.io/2019/10/11/Greenplum-%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《数据库调研笔记 -- GreenPlum》 — LQing的博客&url=https://linqing2017.github.io/2019/10/11/Greenplum-%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/&via=https://LinQing2017.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://linqing2017.github.io/2019/10/11/Greenplum-%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2019/10/17/Greenplum-%E8%B5%84%E6%BA%90%E9%98%9F%E5%88%97/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">数据库调研笔记 -- GreenPlum</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2019/10/08/Greenplum-%E4%BB%8B%E7%BB%8D&%E9%83%A8%E7%BD%B2/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">数据库调研笔记 -- GreenPlum</h4>
      </a>
    </div>
  
</nav>



    




















</article>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>LQing &copy; 2015 - 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://linqing2017.github.io/2019/10/11/Greenplum-%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/&title=《数据库调研笔记 -- GreenPlum》 — LQing的博客&pic=https://LinQing2017.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://linqing2017.github.io/2019/10/11/Greenplum-%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/&title=《数据库调研笔记 -- GreenPlum》 — LQing的博客&source=GreenPlum 调研笔记" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://linqing2017.github.io/2019/10/11/Greenplum-%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《数据库调研笔记 -- GreenPlum》 — LQing的博客&url=https://linqing2017.github.io/2019/10/11/Greenplum-%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/&via=https://LinQing2017.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://linqing2017.github.io/2019/10/11/Greenplum-%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPYAAAD2CAAAAADAeSUUAAADMUlEQVR42u3aUXKCAAwEUO9/aXuAVtkk2IH4+HJaBR5+xGzyeMTHMzh+vz95/eqzv/+en+G0AxsbG/sm7ATzjI9X76/+/T07eZQHZ8PGxsZex05KxfuHlTzKXjnM7y2xYGNjY2P3yknSfiSfSq6IjY2Njd0rYMmtV8vPpC3BxsbG/jZ2tUgkl6zi3zchvXs7IUvDxsbGvjw7n4pe//VH5tvY2NjYF2Y/i0feJPRahbyxGSmwsbGxF7HzAjC5oXnDMGlgXr4TGxsbeyk7H6/m4f6no//k6o/5d4KNjY19SXZ+o71AJ28M8sYmL2MvHxw2Njb2OnZeQnqLPtVwKlkP6hVCbGxs7O9hz8FVwFmDgajtwcbGxl7Krl64euu9sjcZBh+EStjY2Ngr2NXiVB3WVkvdWStE5QgMGxsbewW797O+uS5TjP6Twta8W2xsbOybs3vhTq9o5QUsf7j5A8LGxsbeyp63GUlRaa5IzvuqPFHDxsbGvi27F+L3LlkNg/JyVT4/NjY29mr2fHA7WfeZhFmFUoqNjY29iF3uWk5asumt2lS/pOoYAxsbG/u+7P9Zx5kv7uT4j2dp2NjY2Jdhz9d0eoPhvARWQ6X3Z/5jvo2NjY19c/akd8kHvXkYNGlpykEVNjY29gr2WSF7taRVm4q8OEXJGTY2NvYidnUjcVKWqo++135UB8/Y2NjYO9j5h5NakAdPeZxUXRWKwjJsbGzsRez5SCAPd3orO+UGIy+l2NjY2CvY1Wgpuek89M8LZLVkHoiwsbGx17E/t3DTe0zVoUV+D9jY2Nhb2dVClbcKeRl7X8wmI4eDLA0bGxt7Ebv6sz5pJ/IQKh8bVx/0QQeGjY2NvYKd/9DvreDkZ0hipt5gGBsbG3sf+1k8qsPXXkHqDYYL7RM2Njb2IvZp+z5B8ZisASWtUe+/2NjY2DvY1bFutVGZR0Xzq0ffJDY2NvbN2dUiNAl38gCoF2xFow5sbGzsL2afOxLIA6PJDORgvo2NjY39lexq0zJpdXrxVmFTCRsbG3sFOx+vTkKiagtRLaJJGcPGxsbex84HvZPAqNoqzIcK1QUjbGxs7BuyfwAiITZhp5xebQAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>








<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = 'LQing的博客';
            clearTimeout(titleTime);
        } else {
            document.title = 'LQing的博客';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
